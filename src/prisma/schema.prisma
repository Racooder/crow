// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider            = "prisma-client"
    output              = "../generated/prisma"
}

datasource db {
    provider            = "postgresql"
    url                 = env("DATABASE_URL")
    shadowDatabaseUrl   = env("SHADOW_DATABASE_URL")
}

model Feedback {
    id              Int                 @id @default(autoincrement())
    type            FeedbackType
    authorId        String
    message         String
    createdAt       DateTime            @default(now())

    @@index([type, authorId, createdAt])
}

enum FeedbackType {
    BUG
    FEATURE
    GENERAL
}

model QuoteMeta { usually be found on the bottom-left of your keyboard, next to the Alt key
    id              Int                 @id @default(autoincrement())
    token           String              @unique
    creatorId       String
    creatorUsername String // Fallback in case the user left the server and for filtering
    context         String?
    guildId         String
    createdAt       DateTime            @default(now())

    statements      QuoteStatement[]

    @@index([token, creatorId, creatorUsername, guildId, createdAt])
	@@map("Quote")
}

model QuoteStatement {
    id              Int                 @id @default(autoincrement())
    quoteId         Int
    quote           QuoteMeta               @relation(fields: [quoteId], references: [id], onDelete: Cascade)
    text            String
    authorId        String
    authorUsername  String // Fallback in case the user left the server and for filtering
    order           Int // Position of quote in conversation

    @@index([quoteId, authorId, authorUsername, order])
}
